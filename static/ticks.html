<!DOCTYPE html>
<html>
<head>
    <title>Market Data Ticks</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .price-up {
            color: green;
        }
        .price-down {
            color: red;
        }
    </style>
</head>
<body>
    <h2>Market Data Ticks</h2>
    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Price</th>
                <th>Volume</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="ticksData">
        </tbody>
    </table>

    <script>
        const ticksData = document.getElementById('ticksData');
        let lastPrices = {};
        let ws;

        function connect() {
            ws = new WebSocket('ws://localhost:8080/ws/ticks');
            
            ws.onopen = function() {
                console.log('Connected to ticks stream');
            };
            
            ws.onmessage = function(e) {
                const tick = JSON.parse(e.data);
                updateTickRow(tick);
            };
            
            ws.onclose = function() {
                console.log('Disconnected from ticks stream');
                setTimeout(connect, 3000);
            };
        }

        function updateTickRow(tick) {
            let row = document.getElementById(`tick-${tick.symbol}`);
            const priceChange = lastPrices[tick.symbol] ? tick.price - lastPrices[tick.symbol] : 0;
            const priceClass = priceChange > 0 ? 'price-up' : priceChange < 0 ? 'price-down' : '';
            
            if (!row) {
                row = document.createElement('tr');
                row.id = `tick-${tick.symbol}`;
                ticksData.appendChild(row);
            }

            row.innerHTML = `
                <td>${tick.symbol}</td>
                <td class="${priceClass}">${tick.price.toFixed(2)}</td>
                <td>${tick.volume.toFixed(2)}</td>
                <td>${new Date(tick.timestamp).toLocaleTimeString()}</td>
            `;

            lastPrices[tick.symbol] = tick.price;
        }

        // Start connection
        connect();
    </script>
</body>
</html>
